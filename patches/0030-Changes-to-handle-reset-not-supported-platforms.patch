From 9569b4d9793f40fa7b6591eafd971533a0a78fc5 Mon Sep 17 00:00:00 2001
From: Krishnakumar <krishnakumarx.kulakarni@intel.com>
Date: Tue, 6 Apr 2021 14:03:00 +0530
Subject: [PATCH 030/109] Changes to handle reset not supported platforms

Signed-off-by: Krishnakumar <krishnakumarx.kulakarni@intel.com>
---
 drivers/misc/hddl_device/hddl_device_lh.c | 16 +++++++++++-----
 1 file changed, 11 insertions(+), 5 deletions(-)

diff --git a/drivers/misc/hddl_device/hddl_device_lh.c b/drivers/misc/hddl_device/hddl_device_lh.c
index a506fe69aa69..821ff24c983e 100644
--- a/drivers/misc/hddl_device/hddl_device_lh.c
+++ b/drivers/misc/hddl_device/hddl_device_lh.c
@@ -59,6 +59,7 @@ struct intel_hddl_client_priv {
 	struct intel_hddl_i2c_devs **i2c_devs;
 	struct intel_tsens **tsens;
 	struct intel_hddl_board_info board_info;
+	bool soc_reset_available;
 };
 
 static struct intel_hddl_client_priv *g_priv;
@@ -690,11 +691,16 @@ static int intel_hddl_config_dt(struct intel_hddl_client_priv *priv)
 		dev_err(&pdev->dev, "Unable to get board/soc id");
 		return ret;
 	}
-	ret = hddl_get_board_reset_data(pdev, priv);
-	if (ret) {
-		dev_err(&pdev->dev, "Unable to get reset data");
-		return ret;
-	}
+	priv->soc_reset_available = of_property_read_bool(np, "soc-reset");
+	if (priv->soc_reset_available) {
+		ret = hddl_get_board_reset_data(pdev, priv);
+		if (ret) {
+			dev_err(&pdev->dev, "Unable to get reset data");
+			return ret;
+		}
+	} else
+		dev_err(&pdev->dev, "This platform does not support soc-reset\n");
+
 	ret = hddl_get_onchip_sensors(pdev, priv);
 	if (ret) {
 		dev_err(&pdev->dev, "Onchip sensor config failed");
-- 
2.25.1

