From c93fc4ab7e0849e1f952fba7f5e9a9aa1211b7e7 Mon Sep 17 00:00:00 2001
From: Chenyi Qiang <chenyi.qiang@intel.com>
Date: Fri, 27 Dec 2024 00:47:38 -0800
Subject: [PATCH 28/53] KVM: selftests: Add the 2nd VM exit controls MSR to the
 hidden VMX MSR list

Signed-off-by: Chenyi Qiang <chenyi.qiang@intel.com>
Signed-off-by: Xin Li (Intel) <xin@zytor.com>
---
 tools/arch/x86/include/asm/msr-index.h              | 1 +
 tools/testing/selftests/kvm/x86/feature_msrs_test.c | 1 +
 2 files changed, 2 insertions(+)

diff --git a/tools/arch/x86/include/asm/msr-index.h b/tools/arch/x86/include/asm/msr-index.h
index 3ae84c3b8e6d..95b6e2749256 100644
--- a/tools/arch/x86/include/asm/msr-index.h
+++ b/tools/arch/x86/include/asm/msr-index.h
@@ -1178,6 +1178,7 @@
 #define MSR_IA32_VMX_TRUE_ENTRY_CTLS     0x00000490
 #define MSR_IA32_VMX_VMFUNC             0x00000491
 #define MSR_IA32_VMX_PROCBASED_CTLS3	0x00000492
+#define MSR_IA32_VMX_EXIT_CTLS2		0x00000493
 
 /* Resctrl MSRs: */
 /* - Intel: */
diff --git a/tools/testing/selftests/kvm/x86/feature_msrs_test.c b/tools/testing/selftests/kvm/x86/feature_msrs_test.c
index a72f13ae2edb..815dcb7ad214 100644
--- a/tools/testing/selftests/kvm/x86/feature_msrs_test.c
+++ b/tools/testing/selftests/kvm/x86/feature_msrs_test.c
@@ -27,6 +27,7 @@ static bool is_hidden_vmx_msr(uint32_t msr)
 	case MSR_IA32_VMX_PINBASED_CTLS:
 	case MSR_IA32_VMX_PROCBASED_CTLS:
 	case MSR_IA32_VMX_EXIT_CTLS:
+	case MSR_IA32_VMX_EXIT_CTLS2:
 	case MSR_IA32_VMX_ENTRY_CTLS:
 		return true;
 	default:
-- 
2.34.1

