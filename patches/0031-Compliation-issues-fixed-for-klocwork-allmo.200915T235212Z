From 6767fd6350bca53babe7932f2634a527cdf522ee Mon Sep 17 00:00:00 2001
From: "Raja Subramanian, Lakshmi Bai" <lakshmi.bai.raja.subramanian@intel.com>
Date: Mon, 15 Jun 2020 23:13:12 +0530
Subject: [PATCH 31/48] Compliation issues fixed for klocwork allmod
 configuration

Signed-off-by: Raja Subramanian, Lakshmi Bai <lakshmi.bai.raja.subramanian@intel.com>
---
 drivers/misc/thermal/keembay_thermal.c | 18 +++++++++++++++++-
 include/linux/hddl_device.h            |  5 +++++
 2 files changed, 22 insertions(+), 1 deletion(-)

diff --git a/drivers/misc/thermal/keembay_thermal.c b/drivers/misc/thermal/keembay_thermal.c
index 4a7d03658a40..98d53ce5b018 100644
--- a/drivers/misc/thermal/keembay_thermal.c
+++ b/drivers/misc/thermal/keembay_thermal.c
@@ -250,6 +250,10 @@ static const struct of_device_id keembay_thermal_id_table[] = {
 
 struct keembay_therm_info *g_thermal_data;
 
+
+static int hddl_device_thermal_init(void);
+static int hddl_device_thermal_exit(void);
+
 static int keembay_thermal_probe(struct platform_device *pdev)
 {
 	int ret;
@@ -287,6 +291,11 @@ static int keembay_thermal_probe(struct platform_device *pdev)
 	error = clk_enable(g_thermal_data->thermal_clk);
 	if (error)
 		return error;
+
+#if defined(MODULE)
+	hddl_device_thermal_init();
+#endif /* MODULE */
+
 	return 0;
 }
 
@@ -329,8 +338,13 @@ static int keembay_thermal_exit(struct platform_device *pdev)
 	struct thermal_zone_device *keembay_thermal =
 				platform_get_drvdata(pdev);
 
+#if defined(MODULE)
+	hddl_device_thermal_exit();
+#endif /* MODULE */
+
 	thermal_zone_device_unregister(keembay_thermal);
 	clk_disable_unprepare(g_thermal_data->thermal_clk);
+
 	return 0;
 }
 MODULE_DEVICE_TABLE(of, keembay_thermal_id_table);
@@ -421,8 +435,10 @@ static int hddl_device_thermal_exit(void)
 	return 0;
 };
 
+#if !defined(MODULE)
+late_initcall(hddl_device_thermal_init);
 late_initcall(hddl_device_thermal_init);
-late_initcall(hddl_device_thermal_exit);
+#endif
 
 MODULE_DESCRIPTION("KeemBay Thermal Driver");
 MODULE_AUTHOR("Sandeep Singh <sandeep1.singh@intel.com>");
diff --git a/include/linux/hddl_device.h b/include/linux/hddl_device.h
index aec4ebfb9aea..fbbe402491de 100644
--- a/include/linux/hddl_device.h
+++ b/include/linux/hddl_device.h
@@ -8,6 +8,11 @@
 #ifndef __HDDL_DEVICE_H
 #define __HDDL_DEVICE_H
 
+#include <linux/types.h>
+#include <linux/platform_device.h>
+#include <linux/i2c.h>
+#include <linux/xlink.h>
+
 #define HDDL_MAGIC 'x'
 #define HDDL_READ_SW_ID_DATA    _IOW(HDDL_MAGIC, 'a', void*)
 #define HDDL_SOFT_RESET		      _IOW(HDDL_MAGIC, 'b', void*)
-- 
2.17.1

