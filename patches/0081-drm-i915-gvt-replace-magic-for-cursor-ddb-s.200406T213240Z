From e4f877ce7f1996f6e192e0beea7a4e5e6e9ef635 Mon Sep 17 00:00:00 2001
From: Liu Xinyun <xinyun.liu@intel.com>
Date: Wed, 24 Apr 2019 17:01:38 +0800
Subject: [PATCH 081/100] drm/i915/gvt: replace magic for cursor ddb size with
 GVT_CURSOR_BLOCKS

the cursor ddb size to hard coded to 8 for local display
virtualization. Replace it with GVT_CURSOR_BLOCKS

V2: refine commit message

Tracked-On: projectacrn/acrn-hypervisor#3106
Signed-off-by: Liu Xinyun <xinyun.liu@intel.com>
Reviewed-by: Zhao Yakui <yakui.zhao@intel.com>
---
 drivers/gpu/drm/i915/gvt/gvt.c | 6 +++---
 drivers/gpu/drm/i915/gvt/gvt.h | 1 +
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/i915/gvt/gvt.c b/drivers/gpu/drm/i915/gvt/gvt.c
index dde0c1a79363..441254ed8011 100644
--- a/drivers/gpu/drm/i915/gvt/gvt.c
+++ b/drivers/gpu/drm/i915/gvt/gvt.c
@@ -291,15 +291,15 @@ void intel_gvt_allocate_ddb(struct intel_gvt *gvt, unsigned int active_crtcs)
 		pipe_info[pipe].pipe_ddb.start = start;
 		pipe_info[pipe].pipe_ddb.end = end;
 
-		pipe_info[pipe].plane_ddb_y[PLANE_CURSOR].start = end - 8;
+		pipe_info[pipe].plane_ddb_y[PLANE_CURSOR].start = end - GVT_CURSOR_BLOCKS;
 		pipe_info[pipe].plane_ddb_y[PLANE_CURSOR].end = end;
 
 		plane_cnt = (info->num_sprites[pipe] + 1);
-		plane_size = (pipe_size - 8) / plane_cnt;
+		plane_size = (pipe_size - GVT_CURSOR_BLOCKS) / plane_cnt;
 
 		for_each_universal_plane(dev_priv, pipe, plane) {
 			pipe_info[pipe].plane_ddb_y[plane].start = start +
-				(plane * (pipe_size - 8) / plane_cnt);
+				(plane * (pipe_size - GVT_CURSOR_BLOCKS) / plane_cnt);
 			pipe_info[pipe].plane_ddb_y[plane].end =
 				pipe_info[pipe].plane_ddb_y[plane].start + plane_size;
 		}
diff --git a/drivers/gpu/drm/i915/gvt/gvt.h b/drivers/gpu/drm/i915/gvt/gvt.h
index eed0f1399a2f..18de4ca30095 100644
--- a/drivers/gpu/drm/i915/gvt/gvt.h
+++ b/drivers/gpu/drm/i915/gvt/gvt.h
@@ -53,6 +53,7 @@
 
 #define GVT_MAX_VGPU 8
 
+#define GVT_CURSOR_BLOCKS 8
 struct intel_gvt_host {
 	struct device *dev;
 	bool initialized;
-- 
2.17.1

