From 8b1603165d3fd6d9d7ea6038f7a3fb4836cbb663 Mon Sep 17 00:00:00 2001
From: Meng Wei <wei.meng@intel.com>
Date: Mon, 3 Dec 2018 16:53:53 +0800
Subject: [PATCH 46/69] media: intel-ipu4: use softlink instead of shell copy

The wrapper file will be used across different modules, it would
be a compile issue when in multi thread compile. Previously there
is a shell copy for each build, the problem is again there because
every time build, there will be rebuild of this file.

Make a softlink instead of shell copy to avoid rebuild issue.

Signed-off-by: Ding Yunliang <yunliang.ding@intel.com>
Signed-off-by: Meng Wei <wei.meng@intel.com>
---
 drivers/media/pci/intel/ipu4/ipu4-css/Makefile.isyslib  | 5 -----
 drivers/media/pci/intel/ipu4/ipu4-css/ipu-wrapper.c     | 1 +
 drivers/media/pci/intel/ipu4/ipu4p-css/Makefile.isyslib | 5 -----
 drivers/media/pci/intel/ipu4/ipu4p-css/ipu-wrapper.c    | 1 +
 4 files changed, 2 insertions(+), 10 deletions(-)
 create mode 120000 drivers/media/pci/intel/ipu4/ipu4-css/ipu-wrapper.c
 create mode 120000 drivers/media/pci/intel/ipu4/ipu4p-css/ipu-wrapper.c

diff --git a/drivers/media/pci/intel/ipu4/ipu4-css/Makefile.isyslib b/drivers/media/pci/intel/ipu4/ipu4-css/Makefile.isyslib
index c99c9a898c69..33a3df896919 100644
--- a/drivers/media/pci/intel/ipu4/ipu4-css/Makefile.isyslib
+++ b/drivers/media/pci/intel/ipu4/ipu4-css/Makefile.isyslib
@@ -10,11 +10,6 @@ IPU_ISYSLIB_ROOT = $(srcpath)/$(src)/$(IPU_ISYSLIB_ROOT_REL)
 include $(srcpath)/$(src)/ipu4-css/Makefile.ipu4isys_inc
 include $(srcpath)/$(src)/ipu4-css/Makefile.ipu4isys_src
 
-#
-# copy wrapper here only for isys usage, psys would use the original one
-#
-$(shell cp -f $(srcpath)/$(src)/../ipu-wrapper.c $(srcpath)/$(src)/ipu4-css/ipu-wrapper.c)
-
 intel-ipu4-isys-csslib-objs := \
 			ipu4-css/libintel-ipu4.o \
 			$(IPU_ISYSLIB_SRC)
diff --git a/drivers/media/pci/intel/ipu4/ipu4-css/ipu-wrapper.c b/drivers/media/pci/intel/ipu4/ipu4-css/ipu-wrapper.c
new file mode 120000
index 000000000000..3167dda06f06
--- /dev/null
+++ b/drivers/media/pci/intel/ipu4/ipu4-css/ipu-wrapper.c
@@ -0,0 +1 @@
+../../ipu-wrapper.c
\ No newline at end of file
diff --git a/drivers/media/pci/intel/ipu4/ipu4p-css/Makefile.isyslib b/drivers/media/pci/intel/ipu4/ipu4p-css/Makefile.isyslib
index f0b540d78d2b..d0816c508ed9 100644
--- a/drivers/media/pci/intel/ipu4/ipu4p-css/Makefile.isyslib
+++ b/drivers/media/pci/intel/ipu4/ipu4p-css/Makefile.isyslib
@@ -10,11 +10,6 @@ IPU_ISYSLIB_ROOT = $(srcpath)/$(src)/$(IPU_ISYSLIB_ROOT_REL)
 include $(srcpath)/$(src)/ipu4p-css/Makefile.ipu4pisys_inc
 include $(srcpath)/$(src)/ipu4p-css/Makefile.ipu4pisys_src
 
-#
-# copy wrapper here only for isys usage, psys would use the original one
-#
-$(shell cp -f $(srcpath)/$(src)/../ipu-wrapper.c $(srcpath)/$(src)/ipu4p-css/ipu-wrapper.c)
-
 intel-ipu4p-isys-csslib-objs := \
 		ipu4p-css/libintel-ipu4p.o \
 		$(IPU_ISYSLIB_SRC)
diff --git a/drivers/media/pci/intel/ipu4/ipu4p-css/ipu-wrapper.c b/drivers/media/pci/intel/ipu4/ipu4p-css/ipu-wrapper.c
new file mode 120000
index 000000000000..3167dda06f06
--- /dev/null
+++ b/drivers/media/pci/intel/ipu4/ipu4p-css/ipu-wrapper.c
@@ -0,0 +1 @@
+../../ipu-wrapper.c
\ No newline at end of file
-- 
2.17.1

