From 47ec92faa50b61ee3ef9bd6af219ea22ac36b1bd Mon Sep 17 00:00:00 2001
From: "T R, Thejesh Reddy" <thejesh.reddy.t.r@intel.com>
Date: Thu, 12 Aug 2021 15:20:26 +0530
Subject: [PATCH 054/109] stmmac workaround for HSD1509042892

stmmac workaround for HSD1509042892

Signed-off-by: T R, Thejesh Reddy <thejesh.reddy.t.r@intel.com>
---
 drivers/net/ethernet/stmicro/stmmac/stmmac_main.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/stmicro/stmmac/stmmac_main.c b/drivers/net/ethernet/stmicro/stmmac/stmmac_main.c
index 908490713023..ff7e9812c1b6 100644
--- a/drivers/net/ethernet/stmicro/stmmac/stmmac_main.c
+++ b/drivers/net/ethernet/stmicro/stmmac/stmmac_main.c
@@ -5714,8 +5714,11 @@ static netdev_features_t stmmac_fix_features(struct net_device *dev,
 
 	/* Disable tso if asked by ethtool */
 	if ((priv->plat->tso_en) && (priv->dma_cap.tsoen)) {
-		if (features & NETIF_F_TSO)
+		if (features & NETIF_F_TSO) {
+			struct stmmac_tx_queue *tx_q = &priv->tx_queue[0];
 			priv->tso = true;
+			tx_q->mss = 0;
+		}
 		else
 			priv->tso = false;
 	}
-- 
2.25.1

