From 5cf91aa1cbad8e63f6eb9d8cc1d0820a143a78a7 Mon Sep 17 00:00:00 2001
From: "Kooran Paul, Princy" <princy.kooran.paul@intel.com>
Date: Thu, 14 Aug 2025 11:47:01 +0800
Subject: [PATCH 21/27] Revert "drm/xe/pf: Resend PF provisioning after GT
 reset"

This reverts commit 5c244eeca57ff4e47e1f60310d059346d1b86b9b.

Signed-off-by: Kooran Paul, Princy <princy.kooran.paul@intel.com>
---
 drivers/gpu/drm/xe/xe_gt_sriov_pf_config.c | 27 ----------------------
 1 file changed, 27 deletions(-)

diff --git a/drivers/gpu/drm/xe/xe_gt_sriov_pf_config.c b/drivers/gpu/drm/xe/xe_gt_sriov_pf_config.c
index 53a44702c04a..2420a548cacc 100644
--- a/drivers/gpu/drm/xe/xe_gt_sriov_pf_config.c
+++ b/drivers/gpu/drm/xe/xe_gt_sriov_pf_config.c
@@ -2364,21 +2364,6 @@ int xe_gt_sriov_pf_config_restore(struct xe_gt *gt, unsigned int vfid,
 	return err;
 }
 
-static int pf_push_self_config(struct xe_gt *gt)
-{
-	int err;
-
-	err = pf_push_full_vf_config(gt, PFID);
-	if (err) {
-		xe_gt_sriov_err(gt, "Failed to push self configuration (%pe)\n",
-				ERR_PTR(err));
-		return err;
-	}
-
-	xe_gt_sriov_dbg_verbose(gt, "self configuration completed\n");
-	return 0;
-}
-
 static void fini_config(void *arg)
 {
 	struct xe_gt *gt = arg;
@@ -2402,17 +2387,9 @@ static void fini_config(void *arg)
 int xe_gt_sriov_pf_config_init(struct xe_gt *gt)
 {
 	struct xe_device *xe = gt_to_xe(gt);
-	int err;
 
 	xe_gt_assert(gt, IS_SRIOV_PF(xe));
 
-	mutex_lock(xe_gt_sriov_pf_master_mutex(gt));
-	err = pf_push_self_config(gt);
-	mutex_unlock(xe_gt_sriov_pf_master_mutex(gt));
-
-	if (err)
-		return err;
-
 	return devm_add_action_or_reset(xe->drm.dev, fini_config, gt);
 }
 
@@ -2430,10 +2407,6 @@ void xe_gt_sriov_pf_config_restart(struct xe_gt *gt)
 	unsigned int n, total_vfs = xe_sriov_pf_get_totalvfs(gt_to_xe(gt));
 	unsigned int fail = 0, skip = 0;
 
-	mutex_lock(xe_gt_sriov_pf_master_mutex(gt));
-	pf_push_self_config(gt);
-	mutex_unlock(xe_gt_sriov_pf_master_mutex(gt));
-
 	for (n = 1; n <= total_vfs; n++) {
 		if (xe_gt_sriov_pf_config_is_empty(gt, n))
 			skip++;
-- 
2.43.0

