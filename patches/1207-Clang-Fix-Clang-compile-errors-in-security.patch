From 1f7de19a820752452e1a472783cf262481051539 Mon Sep 17 00:00:00 2001
From: "Li, Yifan" <yifan2.li@intel.com>
Date: Wed, 12 Aug 2020 15:59:56 +0800
Subject: [PATCH 1207/1214] [Clang] Fix Clang compile errors in security.

Signed-off-by: Zhou Furong <furong.zhou@intel.com>
Signed-off-by: Li, Yifan <yifan2.li@intel.com>
---
 include/linux/lsm_hooks.h       | 2 +-
 include/linux/security.h        | 6 +++---
 security/keystore/rdrand.c      | 2 +-
 security/security.c             | 4 ++--
 security/selinux/include/xfrm.h | 2 +-
 security/selinux/xfrm.c         | 2 +-
 6 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/include/linux/lsm_hooks.h b/include/linux/lsm_hooks.h
index 05ed561..376224c 100644
--- a/include/linux/lsm_hooks.h
+++ b/include/linux/lsm_hooks.h
@@ -1745,7 +1745,7 @@ union security_list_options {
 	void (*xfrm_state_free_security)(struct xfrm_state *x);
 	int (*xfrm_state_delete_security)(struct xfrm_state *x);
 	int (*xfrm_policy_lookup)(struct xfrm_sec_ctx *ctx,
-					struct secids *fl_secid, u8 dir);
+					const struct secids *fl_secid, u8 dir);
 	int (*xfrm_state_pol_flow_match)(struct xfrm_state *x,
 						struct xfrm_policy *xp,
 						const struct flowi *fl);
diff --git a/include/linux/security.h b/include/linux/security.h
index 07880c4..64652f9 100644
--- a/include/linux/security.h
+++ b/include/linux/security.h
@@ -1593,11 +1593,11 @@ int security_xfrm_policy_delete(struct xfrm_sec_ctx *ctx);
 int security_xfrm_state_alloc(struct xfrm_state *x, struct xfrm_user_sec_ctx *sec_ctx);
 int security_xfrm_state_alloc_acquire(struct xfrm_state *x,
 				      struct xfrm_sec_ctx *polsec,
-				      struct secids *secid);
+				      const struct secids *secid);
 int security_xfrm_state_delete(struct xfrm_state *x);
 void security_xfrm_state_free(struct xfrm_state *x);
 int security_xfrm_policy_lookup(struct xfrm_sec_ctx *ctx,
-					struct secids *fl_secid, u8 dir);
+					const struct secids *fl_secid, u8 dir);
 int security_xfrm_state_pol_flow_match(struct xfrm_state *x,
 				       struct xfrm_policy *xp,
 				       const struct flowi *fl);
@@ -1650,7 +1650,7 @@ static inline int security_xfrm_state_delete(struct xfrm_state *x)
 }
 
 static inline int security_xfrm_policy_lookup(struct xfrm_sec_ctx *ctx,
-					struct secids *fl_secid, u8 dir)
+					const struct secids *fl_secid, u8 dir)
 {
 	return 0;
 }
diff --git a/security/keystore/rdrand.c b/security/keystore/rdrand.c
index 1de3ddf..27c3d39 100644
--- a/security/keystore/rdrand.c
+++ b/security/keystore/rdrand.c
@@ -71,7 +71,7 @@ int keystore_get_rdrand(uint8_t *buf, int size)
 				"2:",
 				X86_FEATURE_RDRAND,
 				ASM_OUTPUT2("=r" (ret), "=a" (random)),
-				"" (RDRAND_RETRY_LOOPS));
+				"i" (RDRAND_RETRY_LOOPS));
 		buf[i] = random;
 #else
 #pragma message "Compiling with out RDRAND support"
diff --git a/security/security.c b/security/security.c
index 467cda0..9809a36 100644
--- a/security/security.c
+++ b/security/security.c
@@ -2483,7 +2483,7 @@ EXPORT_SYMBOL(security_xfrm_state_alloc);
 
 int security_xfrm_state_alloc_acquire(struct xfrm_state *x,
 				      struct xfrm_sec_ctx *polsec,
-				      struct secids *secid)
+				      const struct secids *secid)
 {
 	return call_int_hook(xfrm_state_alloc_acquire, 0, x, polsec, secid);
 }
@@ -2500,7 +2500,7 @@ void security_xfrm_state_free(struct xfrm_state *x)
 }
 
 int security_xfrm_policy_lookup(struct xfrm_sec_ctx *ctx,
-					struct secids *fl_secid, u8 dir)
+					const struct secids *fl_secid, u8 dir)
 {
 	return call_int_hook(xfrm_policy_lookup, 0, ctx, fl_secid, dir);
 }
diff --git a/security/selinux/include/xfrm.h b/security/selinux/include/xfrm.h
index 99bac3c..d7f99ac 100644
--- a/security/selinux/include/xfrm.h
+++ b/security/selinux/include/xfrm.h
@@ -25,7 +25,7 @@ int selinux_xfrm_state_alloc_acquire(struct xfrm_state *x,
 void selinux_xfrm_state_free(struct xfrm_state *x);
 int selinux_xfrm_state_delete(struct xfrm_state *x);
 int selinux_xfrm_policy_lookup(struct xfrm_sec_ctx *ctx,
-			       struct secids *fl_secid, u8 dir);
+			       const struct secids *fl_secid, u8 dir);
 int selinux_xfrm_state_pol_flow_match(struct xfrm_state *x,
 				      struct xfrm_policy *xp,
 				      const struct flowi *fl);
diff --git a/security/selinux/xfrm.c b/security/selinux/xfrm.c
index 067dd83..f1e5e3d 100644
--- a/security/selinux/xfrm.c
+++ b/security/selinux/xfrm.c
@@ -154,7 +154,7 @@ static int selinux_xfrm_delete(struct xfrm_sec_ctx *ctx)
  * rule.
  */
 int selinux_xfrm_policy_lookup(struct xfrm_sec_ctx *ctx,
-				struct secids *fl_secid, u8 dir)
+				const struct secids *fl_secid, u8 dir)
 {
 	int rc;
 
-- 
2.7.4

