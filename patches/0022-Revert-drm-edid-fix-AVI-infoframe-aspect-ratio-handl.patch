From 4b04cb0fbe5a5e5fcabfbb4eb536591220c36f1b Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Thu, 27 Apr 2023 13:17:56 +0800
Subject: [PATCH 22/68] Revert "drm/edid: fix AVI infoframe aspect ratio
 handling"

This reverts commit 64a99c0ac6f8b714960a71d34a91a54acb4117e4.
---
 drivers/gpu/drm/drm_edid.c | 21 +++++++++------------
 1 file changed, 9 insertions(+), 12 deletions(-)

diff --git a/drivers/gpu/drm/drm_edid.c b/drivers/gpu/drm/drm_edid.c
index 39eb39e78d7a2..4334e466b4e05 100644
--- a/drivers/gpu/drm/drm_edid.c
+++ b/drivers/gpu/drm/drm_edid.c
@@ -5560,6 +5560,8 @@ static u8 drm_mode_hdmi_vic(const struct drm_connector *connector,
 static u8 drm_mode_cea_vic(const struct drm_connector *connector,
 			   const struct drm_display_mode *mode)
 {
+	u8 vic;
+
 	/*
 	 * HDMI spec says if a mode is found in HDMI 1.4b 4K modes
 	 * we should send its VIC in vendor infoframes, else send the
@@ -5569,18 +5571,13 @@ static u8 drm_mode_cea_vic(const struct drm_connector *connector,
 	if (drm_mode_hdmi_vic(connector, mode))
 		return 0;
 
-	return drm_match_cea_mode(mode);
-}
+	vic = drm_match_cea_mode(mode);
 
-/*
- * Avoid sending VICs defined in HDMI 2.0 in AVI infoframes to sinks that
- * conform to HDMI 1.4.
- *
- * HDMI 1.4 (CTA-861-D) VIC range: [1..64]
- * HDMI 2.0 (CTA-861-F) VIC range: [1..107]
- */
-static u8 vic_for_avi_infoframe(const struct drm_connector *connector, u8 vic)
-{
+	/*
+	 * HDMI 1.4 VIC range: 1 <= VIC <= 64 (CEA-861-D) but
+	 * HDMI 2.0 VIC range: 1 <= VIC <= 107 (CEA-861-F). So we
+	 * have to make sure we dont break HDMI 1.4 sinks.
+	 */
 	if (!is_hdmi2_sink(connector) && vic > 64)
 		return 0;
 
@@ -5656,7 +5653,7 @@ drm_hdmi_avi_infoframe_from_display_mode(struct hdmi_avi_infoframe *frame,
 		picture_aspect = HDMI_PICTURE_ASPECT_NONE;
 	}
 
-	frame->video_code = vic_for_avi_infoframe(connector, vic);
+	frame->video_code = vic;
 	frame->picture_aspect = picture_aspect;
 	frame->active_aspect = HDMI_ACTIVE_ASPECT_PICTURE;
 	frame->scan_mode = HDMI_SCAN_MODE_UNDERSCAN;
-- 
2.25.1

