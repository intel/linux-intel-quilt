From c45d0f353f5e52845b9c0c9abd4f6d2c7a5807b6 Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Tue, 20 Jun 2023 05:27:51 +0800
Subject: [PATCH 29/30] Revert "drm/rockchip: Drop unbalanced obj unref"

This reverts commit ae784c3ed37384210a43529f7842c865581c1258.
---
 drivers/gpu/drm/rockchip/rockchip_drm_gem.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/gpu/drm/rockchip/rockchip_drm_gem.c b/drivers/gpu/drm/rockchip/rockchip_drm_gem.c
index 22ff4a5929768..62e5d0970525e 100644
--- a/drivers/gpu/drm/rockchip/rockchip_drm_gem.c
+++ b/drivers/gpu/drm/rockchip/rockchip_drm_gem.c
@@ -250,6 +250,9 @@ static int rockchip_drm_gem_object_mmap(struct drm_gem_object *obj,
 	else
 		ret = rockchip_drm_gem_object_mmap_dma(obj, vma);
 
+	if (ret)
+		drm_gem_vm_close(vma);
+
 	return ret;
 }
 
-- 
2.25.1

