From 89275ffdee75cce4ef2a9c093ffb0e5e16846b55 Mon Sep 17 00:00:00 2001
From: "D, Lakshmi Sowjanya" <lakshmi.sowjanya.d@intel.com>
Date: Fri, 25 Jun 2021 16:07:23 +0800
Subject: [PATCH 1/4] arch: kernel: Add check to validate art_to_tsc_numerator

Return -EINVAL if art_to_tsc_numerator is zero.

Signed-off-by: D, Lakshmi Sowjanya <lakshmi.sowjanya.d@intel.com>
---
 arch/x86/kernel/tsc.c | 9 ++++-----
 1 file changed, 4 insertions(+), 5 deletions(-)

diff --git a/arch/x86/kernel/tsc.c b/arch/x86/kernel/tsc.c
index fc41f400900c..97a5b128c671 100644
--- a/arch/x86/kernel/tsc.c
+++ b/arch/x86/kernel/tsc.c
@@ -1256,18 +1256,17 @@ int convert_tsc_to_art(const struct system_counterval_t *system_counter,
 {
 	u64 tmp, res, rem;
 
-	if (system_counter->cs != art_related_clocksource)
+	if ((system_counter->cs != art_related_clocksource) ||
+	    !art_to_tsc_numerator)
 		return -EINVAL;
 
 	res = system_counter->cycles - art_to_tsc_offset;
-	if (art_to_tsc_numerator)
-		rem = do_div(res, art_to_tsc_numerator);
+	rem = do_div(res, art_to_tsc_numerator);
 
 	*art = res * art_to_tsc_denominator;
 	tmp = rem * art_to_tsc_denominator;
 
-	if (art_to_tsc_numerator)
-		do_div(tmp, art_to_tsc_numerator);
+	do_div(tmp, art_to_tsc_numerator);
 	*art += tmp;
 
 	return 0;
-- 
2.17.1

