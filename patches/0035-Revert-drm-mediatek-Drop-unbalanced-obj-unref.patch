From 2fb5a40fab4c3791984380279dd03b244cd5ddfb Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Thu, 27 Apr 2023 13:18:04 +0800
Subject: [PATCH 35/68] Revert "drm/mediatek: Drop unbalanced obj unref"

This reverts commit 3a50d86696f6a7305b84987a9096ed111bf85e8f.
---
 drivers/gpu/drm/mediatek/mtk_drm_gem.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/gpu/drm/mediatek/mtk_drm_gem.c b/drivers/gpu/drm/mediatek/mtk_drm_gem.c
index 29702dd8631d4..43c54dde2f3fc 100644
--- a/drivers/gpu/drm/mediatek/mtk_drm_gem.c
+++ b/drivers/gpu/drm/mediatek/mtk_drm_gem.c
@@ -142,6 +142,8 @@ static int mtk_drm_gem_object_mmap(struct drm_gem_object *obj,
 
 	ret = dma_mmap_attrs(priv->dma_dev, vma, mtk_gem->cookie,
 			     mtk_gem->dma_addr, obj->size, mtk_gem->dma_attrs);
+	if (ret)
+		drm_gem_vm_close(vma);
 
 	return ret;
 }
-- 
2.25.1

