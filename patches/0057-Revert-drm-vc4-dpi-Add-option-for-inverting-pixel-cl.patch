From 771edfdec44bd883b722bd6659510b8aa756f0eb Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Thu, 27 Apr 2023 13:18:16 +0800
Subject: [PATCH 57/68] Revert "drm/vc4: dpi: Add option for inverting pixel
 clock and output enable"

This reverts commit 09c6e21d6a1eaacac54a5d1ea7202e8383a886e6.
---
 drivers/gpu/drm/vc4/vc4_dpi.c | 66 +++++++++++++++--------------------
 1 file changed, 28 insertions(+), 38 deletions(-)

diff --git a/drivers/gpu/drm/vc4/vc4_dpi.c b/drivers/gpu/drm/vc4/vc4_dpi.c
index 0e25add2df071..a90f2545baee0 100644
--- a/drivers/gpu/drm/vc4/vc4_dpi.c
+++ b/drivers/gpu/drm/vc4/vc4_dpi.c
@@ -148,45 +148,35 @@ static void vc4_dpi_encoder_enable(struct drm_encoder *encoder)
 	}
 	drm_connector_list_iter_end(&conn_iter);
 
-	if (connector) {
-		if (connector->display_info.num_bus_formats) {
-			u32 bus_format = connector->display_info.bus_formats[0];
-
-			switch (bus_format) {
-			case MEDIA_BUS_FMT_RGB888_1X24:
-				dpi_c |= VC4_SET_FIELD(DPI_FORMAT_24BIT_888_RGB,
-						       DPI_FORMAT);
-				break;
-			case MEDIA_BUS_FMT_BGR888_1X24:
-				dpi_c |= VC4_SET_FIELD(DPI_FORMAT_24BIT_888_RGB,
-						       DPI_FORMAT);
-				dpi_c |= VC4_SET_FIELD(DPI_ORDER_BGR,
-						       DPI_ORDER);
-				break;
-			case MEDIA_BUS_FMT_RGB666_1X24_CPADHI:
-				dpi_c |= VC4_SET_FIELD(DPI_FORMAT_18BIT_666_RGB_2,
-						       DPI_FORMAT);
-				break;
-			case MEDIA_BUS_FMT_RGB666_1X18:
-				dpi_c |= VC4_SET_FIELD(DPI_FORMAT_18BIT_666_RGB_1,
-						       DPI_FORMAT);
-				break;
-			case MEDIA_BUS_FMT_RGB565_1X16:
-				dpi_c |= VC4_SET_FIELD(DPI_FORMAT_16BIT_565_RGB_3,
-						       DPI_FORMAT);
-				break;
-			default:
-				DRM_ERROR("Unknown media bus format %d\n",
-					  bus_format);
-				break;
-			}
-		}
-
-		if (connector->display_info.bus_flags & DRM_BUS_FLAG_PIXDATA_DRIVE_NEGEDGE)
-			dpi_c |= DPI_PIXEL_CLK_INVERT;
+	if (connector && connector->display_info.num_bus_formats) {
+		u32 bus_format = connector->display_info.bus_formats[0];
 
-		if (connector->display_info.bus_flags & DRM_BUS_FLAG_DE_LOW)
-			dpi_c |= DPI_OUTPUT_ENABLE_INVERT;
+		switch (bus_format) {
+		case MEDIA_BUS_FMT_RGB888_1X24:
+			dpi_c |= VC4_SET_FIELD(DPI_FORMAT_24BIT_888_RGB,
+					       DPI_FORMAT);
+			break;
+		case MEDIA_BUS_FMT_BGR888_1X24:
+			dpi_c |= VC4_SET_FIELD(DPI_FORMAT_24BIT_888_RGB,
+					       DPI_FORMAT);
+			dpi_c |= VC4_SET_FIELD(DPI_ORDER_BGR, DPI_ORDER);
+			break;
+		case MEDIA_BUS_FMT_RGB666_1X24_CPADHI:
+			dpi_c |= VC4_SET_FIELD(DPI_FORMAT_18BIT_666_RGB_2,
+					       DPI_FORMAT);
+			break;
+		case MEDIA_BUS_FMT_RGB666_1X18:
+			dpi_c |= VC4_SET_FIELD(DPI_FORMAT_18BIT_666_RGB_1,
+					       DPI_FORMAT);
+			break;
+		case MEDIA_BUS_FMT_RGB565_1X16:
+			dpi_c |= VC4_SET_FIELD(DPI_FORMAT_16BIT_565_RGB_3,
+					       DPI_FORMAT);
+			break;
+		default:
+			DRM_ERROR("Unknown media bus format %d\n", bus_format);
+			break;
+		}
 	} else {
 		/* Default to 24bit if no connector found. */
 		dpi_c |= VC4_SET_FIELD(DPI_FORMAT_24BIT_888_RGB, DPI_FORMAT);
-- 
2.25.1

