From c03b5698568be2bbdc1fd168ea6b1063a81ddce0 Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Tue, 20 Jun 2023 05:27:36 +0800
Subject: [PATCH 01/30] Revert "drm/atomic: Don't pollute crtc_state->mode_blob
 with error pointers"

This reverts commit ea0d413094e064389755fd3585a4264b54d1d44a.
---
 drivers/gpu/drm/drm_atomic_uapi.c | 14 ++++++--------
 1 file changed, 6 insertions(+), 8 deletions(-)

diff --git a/drivers/gpu/drm/drm_atomic_uapi.c b/drivers/gpu/drm/drm_atomic_uapi.c
index b6062833370f1..25c269bc46815 100644
--- a/drivers/gpu/drm/drm_atomic_uapi.c
+++ b/drivers/gpu/drm/drm_atomic_uapi.c
@@ -75,17 +75,15 @@ int drm_atomic_set_mode_for_crtc(struct drm_crtc_state *state,
 	state->mode_blob = NULL;
 
 	if (mode) {
-		struct drm_property_blob *blob;
-
 		drm_mode_convert_to_umode(&umode, mode);
-		blob = drm_property_create_blob(crtc->dev,
-						sizeof(umode), &umode);
-		if (IS_ERR(blob))
-			return PTR_ERR(blob);
+		state->mode_blob =
+			drm_property_create_blob(state->crtc->dev,
+		                                 sizeof(umode),
+		                                 &umode);
+		if (IS_ERR(state->mode_blob))
+			return PTR_ERR(state->mode_blob);
 
 		drm_mode_copy(&state->mode, mode);
-
-		state->mode_blob = blob;
 		state->enable = true;
 		DRM_DEBUG_ATOMIC("Set [MODE:%s] for [CRTC:%d:%s] state %p\n",
 				 mode->name, crtc->base.id, crtc->name, state);
-- 
2.25.1

